nodes:
  - address: 192.168.178.51 # hostname or IP to access nodes
    user: hal9000 # root user (usually 'root')
    role: [controlplane,etcd,worker] # K8s roles for node
    ssh_key_path: /home/hal9000/.ssh/id_rsa
  - address: 192.168.178.46 
    user: hal9000
    role: [controlplane,etcd,worker]
    ssh_key_path: /home/hal9000/.ssh/id_rsa
  - address: 192.168.178.47 
    user: hal9000
    role: [controlplane,etcd,worker]
    ssh_key_path: /home/hal9000/.ssh/id_rsa

services:
  etcd:
    snapshot: true
    creation: 6h
    retention: 24h

addons: |-
  ---
  kind: Namespace
  apiVersion: v1
  metadata:
    name: cattle-system
  ---
  kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: cattle-admin
    namespace: cattle-system
  ---
  kind: ClusterRoleBinding
  apiVersion: rbac.authorization.k8s.io/v1
  metadata:
    name: cattle-crb
    namespace: cattle-system
  subjects:
  - kind: ServiceAccount
    name: cattle-admin
    namespace: cattle-system
  roleRef:
    kind: ClusterRole
    name: cluster-admin
    apiGroup: rbac.authorization.k8s.io
  ---
  apiVersion: v1
  kind: Secret
  metadata:
    name: cattle-keys-ingress
    namespace: cattle-system
  type: Opaque
  data:
    tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIRENDQWdTZ0F3SUJBZ0lKQU1scjFOaDVncDc0TUEwR0NTcUdTSWIzRFFFQkN3VUFNQmt4RnpBVkJnTlYKQkFNTURrMTVJRzkzYmlCeWIyOTBJRU5CTUI0WERUSXdNREl4TnpFME1USTFPRm9YRFRJeE1ESXhOakUwTVRJMQpPRm93R2pFWU1CWUdBMVVFQXd3UGJtZHBibmd1Wm5KcGRIb3VZbTk0TUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGCkFBT0NBUThBTUlJQkNnS0NBUUVBdXp5MytYZW16WGVGTUhlVWxLendzY0ExRG50SllvUStxN3FSU3puUWM3dS8KMHRoeFJ2UWN1aWNrenFUWjUyMTBlUGF3YldubTlmajdaR2pjM2dYcHZsTVNxdnNhak90ZEE1WHIvTVY2T1lpQgpyME5JZkNsejEydHpLbmZDM2t4eXFnK285MlZacWdDbi84M21qNndCZzl5ZUJteHNOOVJ4V2E5WG9vRTdHN2o2CjhTUTFtWXhJb0xUaE96K3BKdHd4ejltS3REQXlCdXZDTHdOamNtcHErY1RVbDdXdSsxekZSbDZvNXlOa0w2blAKZkYvMC9GTWU3OFZVeGtwUDc2ZXV3VXdiNzkzbWJQN0kvUWlFSU00VTFmVHFEVlJnUENUMHR5RmV2M3R0QkxPNQpBMnF2RXBnQVJhUzFWbFZ3YjlUQjRMM1Q2U0xOR2E2R3ZkVFlXYUNibXdJREFRQUJvMll3WkRBSkJnTlZIUk1FCkFqQUFNQXNHQTFVZER3UUVBd0lGNERBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXcKS3dZRFZSMFJCQ1F3SW9JUGJtZHBibmd1Wm5KcGRIb3VZbTk0Z2c5dVoybHVlQzVtY21sMGVpNWliM2d3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFFaXdCTGUzcU5xWldTZTY5eXFpaFFIVlh5RUxNbTl6cEpzUlJ3ZnZ0VnlRCjNzVHEwZUk2VS8zRkVRblowdG9Pa2F1ODZCREV1WFlmV0JQbHV0MHg5V0xYQ3g2dzh5dXRlYXRMRW9MMjVaR20KZjlFWk5TQ3pqSnJENHVCY1AwV2tXbC9NUnB1Z2Q2VDM1M3h3S1pwbmplV1lrRzBuVHh1eXZuVWZnRFJVNEk1ZQpSWmV2WEEvMlNyQXVXK0FVVVRGb2JxSWNnZHBGWjNwcG1rTVJYdEJTRkgrZTgxdTI1RnhBSkc2N2JNWUp1NDFQClc5NzVHWDVmd3JFM1lQY0RHSENMT3lQZm9XVXdmTVlZVEUxWTNmVGNNd2hTN3p6dmZQV2NjOHltMFpuYUpZK0cKWXZhYjRRZFNNdnJQdDJCYmxqZlJxc1NqZ1VBUjdiZDFrV0hpVEdWckM4OD0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBdXp5MytYZW16WGVGTUhlVWxLendzY0ExRG50SllvUStxN3FSU3puUWM3dS8wdGh4ClJ2UWN1aWNrenFUWjUyMTBlUGF3YldubTlmajdaR2pjM2dYcHZsTVNxdnNhak90ZEE1WHIvTVY2T1lpQnIwTkkKZkNsejEydHpLbmZDM2t4eXFnK285MlZacWdDbi84M21qNndCZzl5ZUJteHNOOVJ4V2E5WG9vRTdHN2o2OFNRMQptWXhJb0xUaE96K3BKdHd4ejltS3REQXlCdXZDTHdOamNtcHErY1RVbDdXdSsxekZSbDZvNXlOa0w2blBmRi8wCi9GTWU3OFZVeGtwUDc2ZXV3VXdiNzkzbWJQN0kvUWlFSU00VTFmVHFEVlJnUENUMHR5RmV2M3R0QkxPNUEycXYKRXBnQVJhUzFWbFZ3YjlUQjRMM1Q2U0xOR2E2R3ZkVFlXYUNibXdJREFRQUJBb0lCQURPQ0g2WnNTU0hyQ0dQdAo4Wno0K25vYnd6ekpvOFdMVmVaT085d3krbXBzTXZnZy9RQ2s5U1lzMEk1Y2dXbU9EZVdkRDZuNTRVUzNpd2p6ClpCZGNEeEtCcmZnRmZpZFlORTFoTi90Z3BDQWhzbk54a2dZK0xSVU5CVENnbzZZZDU4bHE1M092bVB3UWxDYm0KRU5CalpFTlBOTlhWaSt2TDhLYlllc1pFd09yOS9lTjVLR0d3SjMrYVZRaWMxaFNuc0hucmNwMTFHQW1hdnF4ZAozWlVJTjhjcEowUGF1ZVNHemtwUjdSS1FvdjFveSs3cUdOVWZOME1xdlNuYkllL1hhV0hsY2x6L25UTXRDaWM2CjIzS0d5NEl4cU1QTFJWVlRybWY1WVd1bjlOY25iUXFhZGo0ZHlTb0hzYjNpT1pFejAyMmp4UzZBc3RWS09Rd3EKZnU2QTRaRUNnWUVBK2FNc3JyeHB0MmF1YWVUbXN4RlgxbWp6NjY0TFhWT0xvb2FXd0NDNkd5NGYwS0JDOTlWawpKR0RrRG9DV3d4dEdXU0FtR0NMZm0yVVozZEs3MnlTNzlLdGpvZndBSW1FTWdybDg3ZnRjRDY5bnVyMWswcVdCClR3UnFCQlJvaGZ4MmIvSlV0Vko0RHphVVB3WUNTS3BkUW5nR21RSXpSRjZ0aUxiekZVandJbU1DZ1lFQXdBSmwKdHo1QVBjUXY4cGFoT2VFQzE4c3p4RXh5N3pjVDEwRDlHbE5FaHZSZWljQ3lEL0tMb3cyTDRNN2o1NXR0WmFNMQpSNmRlbEJ0Y2NNdHN4eittRDgxNnpBUzhSRWl3RW92RzlXUFpHMXZJVDd5enhhT1RHOXNTNUVtczJEL0U3ZEpDCnd6UGMvTnh5RmYzTWQ5bC9HWDVsTS9nTUx3RkdrSFdPM1dRS3kya0NnWUVBMWhzbWlxT2NoQ2swTkN5WDFVTnQKczc2R1hrQUREVU5IZ3RpdVdSQjRyakVzSmxJZHZkUXV0S2pKVU1ybkEyWFVPMExBaVhqM2taN3Z4WG9sbHJuMQozczVVZ0t6VExLbFNBcGkyVnFKOGZoTnlBdzdIZDRkdDFXaXl5TmI4SXRhNmVoODhtZHVtajEyL1hpSjRPUHl0ClNnSUpucGZ0Z3BrMWV3bDJpVzNxVDRNQ2dZQjErVU1iNnNDMzhySHZJSVBoTnhKekdtUXRLVGU1S1NNa3I4YVQKaFRQbW80RHVySm43V0hCWmQ3cEpIM1ZDV2VwR2Q1Z0Y5WjBUN1JmSUtnVWxDME55RkROdDVUN3p5YUY5VTZxawpIWHhJNWdUV2tULzNvRUNEN2YvV2lqb01DR3BzSVROcUVwU21QS0JRU01kM29BZ0sxdkZCbEJlUVRmMVlSeExICmptOWZlUUtCZ0gyaEo5UlBQZDZDTXFXZElBRDl0c1lhTWF2NUEra1ZiVlV2eFIrVzRZQUxkRXZsYW5XUGNCTzIKMWZBSXdIUkYwTy9UZHBsV2Z1SDVGS0JTZlFkT0N1QjE1SjRVV2NIQ3UxSTdBbXNFU3lOakNxNE1PZTFDeXBLYwpNQi9yQzMwckhqVEpkNHpDOGp6eTVrUk5wL2dCWituM0haSEt3RHJHV0s1YVhwMjloU2lECi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
  ---
  apiVersion: v1
  kind: Secret
  metadata:
    name: cattle-keys-server
    namespace: cattle-system
  type: Opaque
  data:
    cacerts.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURMekNDQWhlZ0F3SUJBZ0lKQUpWSFFoTjRoZzJjTUEwR0NTcUdTSWIzRFFFQkN3VUFNQmt4RnpBVkJnTlYKQkFNTURrMTVJRzkzYmlCeWIyOTBJRU5CTUI0WERUSXdNREl4TnpFME1USTFPRm9YRFRJMU1ESXhOVEUwTVRJMQpPRm93R1RFWE1CVUdBMVVFQXd3T1RYa2diM2R1SUhKdmIzUWdRMEV3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBCkE0SUJEd0F3Z2dFS0FvSUJBUUMxWXZvTkJEcHdzTVcxUjN5WDdZK2dBa3BGMFBMSjFvcTEreU8zMkFQSnFSVmcKRHJDSXNBWnk1QW01Z0EyOSs5aWZTUlp0emZERDJQSy8vL1Q2eFlmODBTZmZoWHY0NWhtRWNoMzdzdTNYS3JFLwpxNjRyTDhlNlBpNDZ4czQ4WlZ3bDlJOWI5QStSNDdubnBnbkRaZ3lObE53bm10em5OQzFzdDAzaHVXRndUWG9CCmdYL2IzRnd5aG5raGdqU0RtSDZJK1dzSUlVQzBwNXhNeS9CVEVCR2VUNXpLWFc0Zk96NmlmeXFmQlhrZ3hzNWcKbVV6Kyt4V0tsZkpZbTZrME55TFM3UVphc01lTXpIZjNPU084dE1FeFRBcVVBMVBBd0lVM0pNR281cE00cWxsdgpGMTF6OGdkY0Q2Szd6Z1pXdFRVajJQTjROQVcwWTlodmZsSkhLdVNCQWdNQkFBR2plakI0TUIwR0ExVWREZ1FXCkJCVENjN2tlVEcxYXU1eWVSKzg3SlJsMERkcjRtekJKQmdOVkhTTUVRakJBZ0JUQ2M3a2VURzFhdTV5ZVIrODcKSlJsMERkcjRtNkVkcEJzd0dURVhNQlVHQTFVRUF3d09UWGtnYjNkdUlISnZiM1FnUTBHQ0NRQ1ZSMElUZUlZTgpuREFNQmdOVkhSTUVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ25TSVQ1R0FER1dNdkpseWVYCmMzYmx6RXFlMVB6VTVuRkFNbE9xV1dUSG5BMld5NHJoVjFaamZldW5zWGhwWnBPcEdBTlVuaXdhdmZwZHd1MUwKYnIvTFZpUDhEeVFaZWxKbDVVVVRKZlpxQWxEcUM2dnNQUUJpT2YySW9RdnpwRGZzWGUxdzJnRGVFcEt3aEhWKwpLWU5pWmt1eE9wSGJud0tIMnk3bDRYM0tPUkVrZm0zRGZUVGNDdGxudUhINC82bk41azdNaCsrME5iTEphdjN0CkZCWEErbHZEa3dRcTNnR3p4TWJISFY0dW9aMzA1bWt5MHZmRVBseEJSenh1OVluTUJjS1llNHU1ayttQTBvSjAKVTVsZDgxSWdlODBHNUxVWWZya2Z3Vm5JQjUwU3ZPc05JLzEycjFTaDRCT1lFaFVoTGQydUxDQ1ViTytFRnAzMApRZ2ZvCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  ---
  apiVersion: v1
  kind: Service
  metadata:
    namespace: cattle-system
    name: cattle-service
    labels:
      app: cattle
  spec:
    ports:
    - port: 80
      targetPort: 80
      protocol: TCP
      name: http
    - port: 443
      targetPort: 443
      protocol: TCP
      name: https
    selector:
      app: cattle
  ---
  apiVersion: extensions/v1beta1
  kind: Ingress
  metadata:
    namespace: cattle-system
    name: cattle-ingress-http
    annotations:
      nginx.ingress.kubernetes.io/proxy-connect-timeout: "30"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "1800"   # Max time in seconds for ws to remain shell window open
      nginx.ingress.kubernetes.io/proxy-send-timeout: "1800"   # Max time in seconds for ws to remain shell window open
  spec:
    rules:
    - host: nginx.fritz.box  # FQDN to access cattle server
      http:
        paths:
        - backend:
            serviceName: cattle-service
            servicePort: 80
    tls:
    - secretName: cattle-keys-ingress
      hosts:
      - nginx.fritz.box      # FQDN to access cattle server
  ---
  kind: Deployment
  apiVersion: extensions/v1beta1
  metadata:
    namespace: cattle-system
    name: cattle
  spec:
    replicas: 1
    template:
      metadata:
        labels:
          app: cattle
      spec:
        serviceAccountName: cattle-admin
        containers:
        # Rancher install via RKE addons is only supported up to v2.0.8
        - image: rancher/rancher:v2.0.8
          imagePullPolicy: Always
          name: cattle-server
  #       env:
  #       - name: HTTP_PROXY
  #         value: "http://your_proxy_address:port"
  #       - name: HTTPS_PROXY
  #         value: "http://your_proxy_address:port"
  #       - name: NO_PROXY
  #         value: "localhost,127.0.0.1,0.0.0.0,10.43.0.0/16,your_network_ranges_that_dont_need_proxy_to_access"
          livenessProbe:
            httpGet:
              path: /ping
              port: 80
            initialDelaySeconds: 60
            periodSeconds: 60
          readinessProbe:
            httpGet:
              path: /ping
              port: 80
            initialDelaySeconds: 20
            periodSeconds: 10
          ports:
          - containerPort: 80
            protocol: TCP
          - containerPort: 443
            protocol: TCP
          volumeMounts:
          - mountPath: /etc/rancher/ssl
            name: cattle-keys-volume
            readOnly: true
        volumes:
        - name: cattle-keys-volume
          secret:
            defaultMode: 420
            secretName: cattle-keys-server
